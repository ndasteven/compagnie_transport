
    <!--information home-->

    <div class="info-user">
       <!--tableau info GARE-->
        <div class="col-12 col-lg-4 d-flex">
                <div class="card radius-10 w-100">
                <div class="card-header">
                <div class="d-flex align-items-center">
                <div>
                  <h6 class="mb-0">GARES </h6>
                </div>
                <div class="dropdown ms-auto">
                  <a class="dropdown-toggle dropdown-toggle-nocaret" href="#" data-bs-toggle="dropdown"><i class='bx bx-dots-horizontal-rounded font-22 text-option'></i>
                  </a>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item addGare" href="javascript:;">Créer une Gare</a>
                    </li>
                    <li><a class="dropdown-item" href="javascript:;">Modifier une gare</a>
                    </li>
                    <li>
                      <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" href="javascript:;">Supprimer une gare</a>
                    </li>
                  </ul>
                </div>
                </div>
                </div>
                <div class="card-body border-bottom">
                <div class="chart-container-2 row">
                  <div class="col-md-12 ">
                     <img src="assets/images/gare.avif" style="max-width: 100%;" alt="">
                  </div>
                </div>
                </div>
                <ul class="list-group list-group-flush" id="list_gare">
                </ul>
                </div>
          </div>
      <!--fin tableau info GARE-->

     <!--tableau info utilisateurs-->
    <div class="card radius-10 ">
        <div class="card-header">
            <div class="d-flex align-items-center">
                <div>
                    <h6 class="mb-0">Les utilisateurs de la gare de </h6>
                </div>
                <div class="dropdown ms-auto">
                    <a class="dropdown-toggle dropdown-toggle-nocaret" href="#" data-bs-toggle="dropdown"><i class='bx bx-dots-horizontal-rounded font-22 text-option'></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item addUser" href="javascript:;">Ajouter un utilisateur</a>
                        </li>
                        <li><a class="dropdown-item" href="javascript:;">Modifier un utilisateur</a>
                        </li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="javascript:;">Supprimer un utilisateur</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
             <div class="card-body">
             <div class="table-responsive">
               <table class="table align-middle mb-0">
                <thead class="table-light">
                 <tr>
                   <th>Nom</th>
                   <th>Prenom</th>
                   <th>Téléphone</th>
                   <th>Gare</th>
                   <th>Tickets vendu</th>
                   <th>Montant total Tickets</th>
                   <th>Ville</th>
                   <th>Taux de vente</th>
                 </tr>
                 </thead>
                 <tbody class="user_info" style="font-size: 12px;">
                  <tr>
                    <td style="text-align: center;">chargement......</td>
                  </tr>
                 </tbody>
              </table>
              </div>
             </div>
             
      </div>
<!--fin tableau info utilisateur-->
  </div>
    <!--fin information home-->

    <!--formulaire pour creer Gare-->
    <div class="row formGare" style="display: none;">
      <div class="col-lg-8 mx-auto">
        <div class="card">
        <div class="card-body p-4">
          <h5 class="mb-4">Renseignez les informations de la GARE </h5>
          <div>
            <p class="error_gare" style="color: red;"></p>
          </div>
            <div class="form_gare">
            <div class="row mb-3">
              <label for="input35" class="col-sm-3 col-form-label">Nom de la GARE</label>
              <div class="col-sm-9">
                <input type="text" class="form-control gare_name" id="input35" placeholder="Entrer nom utilisateur">
              </div>
            </div>
            <div class="row mb-3">
              <label for="input35" class="col-sm-3 col-form-label">Situation Géographique</label>
              <div class="col-sm-9">
                <input type="text" class="form-control gare_position" id="input35" placeholder="Entrer la situation géographique de la GARE">
              </div>
            </div>

            <div class="row">
              <label class="col-sm-3 col-form-label"></label>
              <div class="col-sm-9">
                <div class="d-md-flex d-grid align-items-center gap-3">
                  <button type="button" class="btn btn-primary px-4 valide_gare">Enregistrer la Gare</button>
                  <button type="button" class="btn btn-light annuler px-4">Annuler</button>
                </div>
              </div>
            </div>
          </div>

          <div class="row retour" style="display: none;">
            <label class="col-sm-3 col-form-label"></label>
            <div class="col-sm-9">
              <div class="d-md-flex d-grid align-items-center gap-3">
                <button type="button" class="btn btn-light annuler px-4">Retour</button>
              </div>
            </div>
          </div>

        </div>
        </div>
      </div>
    </div>
    <!--fin formulaire pour creer Gare-->
    <!--formulaire pour creer utilisateur-->
    <div class="row formUser" style="display: none;">
          <div class="col-lg-8 mx-auto">
            <div class="card">
            <div class="card-body p-4">
              <h5 class="mb-4">Renseignez les information du nouveau utilisateurs</h5>
              <div>
                <p class="error_user" style="color: red;"></p>
              </div>
                <div class="row mb-3">
                  <label for="input35" class="col-sm-3 col-form-label">Nom utilisateur</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control nom" id="input35" placeholder="Entrer nom utilisateur">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="input36" class="col-sm-3 col-form-label">Prenom utilisateur</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control prenom" id="input36" placeholder="Entrer prenom utilisateur">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="input37" class="col-sm-3 col-form-label">Date de naissance</label>
                  <div class="col-sm-9">
                    <input type="date" class="form-control date_naissance" id="input37" placeholder="selectionner la date de naissance utilisateur">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="input38" class="col-sm-3 col-form-label">Pseudo utilisateur</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control pseudo" id="input38" placeholder="choisir Pseudo utilisateur">
                  </div>
                </div>
                
                <div class="row mb-3">
                  <label for="input38" class="col-sm-3 col-form-label ">Mot de passe utilisateur</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control password" id="input38" placeholder="Mot de passe de l'utilisateur">
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="input39" class="col-sm-3 col-form-label">GARE de l'utilisateur</label>
                  <div class="col-sm-9">
                    <select class="form-select gare_user" id="option_gare">
                    </select>
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="input40" class="col-sm-3 col-form-label">Numéro de Tel</label>
                  <div class="col-sm-9">
                    <input type="text" class="form-control tel" id="input38" placeholder="Numéro de Téléphone de l'utilisateur">
                  </div>
                </div>
                <div class="row">
                  <label class="col-sm-3 col-form-label"></label>
                  <div class="col-sm-9">
                    <div class="d-md-flex d-grid align-items-center gap-3">
                      <button type="button" class="btn btn-primary px-4 valid valide_user">Enregistrer l'utilisateur</button>
                      <button type="button" class="btn btn-light annuler px-4">Annuler</button>
                    </div>
                  </div>
                </div>
            </div>
            </div>
          </div>
    </div>
    <!--fin formulaire pour creer utilisateur-->

            <script>
              
            $(document).ready(function() {
              
              //script pour creer utilisateurs
              $('.addUser').on('click',()=>{
                
                $('.info-user').css({'display':'none'})
                $('.formUser').css({'display':'block'})
              })
              $('.annuler').on('click',()=>{
                $('.info-user').css({'display':'block'})
                $('.formUser').css({'display':'none'})
                $('.formGare').css({'display':'none'})
              })
              //fin script pour creer utilisateurs

              //enregistrer utilisateur
              $('.valide_user').on('click', function(){
                if ($('.nom').val().length >= 2 && $('.prenom').val().length >= 2 && $('.date_naissance').val().length >= 2 && $('.pseudo').val().length >= 2 && $('.password').val().length >= 5 && $('.gare_user').val().length >= 2 && $('.tel').val().length >= 10  ) {
                  var myData = {
                    user_nom: $('.nom').val(),
                    user_prenom: $('.prenom').val(),
                    user_date_naissance: $('.date_naissance').val(),
                    user_pseudo: $('.pseudo').val(),
                    user_password: $('.password').val(),
                    user_gare: $('.gare_user').val(),
                    user_tel: $('.tel').val(),
                  }
                  $('.error_user').text('')
                  $.ajax({
                    type: "POST",
                    url: "controlleur.php",
                    data: myData,
                    success: function(response) {
                      var message = JSON.parse(response)
                      $('.error_user').text(message).css({'color':'green'})
                      $('.retour').css({
                        'display':'block'
                      })
                      $('.addUser').css({
                        'display':'none'
                      })
                    },
                    error: function(xhr, status, error) {
                      console.error("AJAX error:", status, error);
                      
                    }
                  })
                }else{
                  $('.error_user').text('entrer les informations utilisateurs valide')
                }
              })
              //fin enregistrer utilisateur

              //script pour creer Gare
              $('.addGare').on('click',()=>{
                $('.info-user').css({'display':'none'})
                $('.formGare').css({'display':'block'})
              })
              $('.annuler').on('click',()=>{
                $('.info-user').css({'display':'block'})
                $('.formGare').css({'display':'none'})
                $('.formUser').css({'display':'none'})
              })
              //fin script pour creer Gare

              //enregistrement d'une gare
              $('.valide_gare').on('click', function(){
                if ($('.gare_name').val().length > 5 && $('.gare_position').val().length > 5) {
                  var myData = {
                    gare_name: $('.gare_name').val(),
                    gare_position: $('.gare_position').val()
                  }
                  $('.error_gare').text('')
                  $.ajax({
                    type: "POST",
                    url: "controlleur.php",
                    data: myData,
                    success: function(response) {
                      var message = JSON.parse(response)
                      $('.error_gare').text(message).css({'color':'green'})
                      $('.retour').css({
                        'display':'block'
                      })
                      $('.form_gare').css({
                        'display':'none'
                      })
                    },
                    error: function(xhr, status, error) {
                      console.error("AJAX error:", status, error);
                      
                    }
                  })
                }else{
                  $('.error_gare').text('Entrer des informations valide')
                }
              })
              //fin enregistrement d'une gare
              //script pour lister les gare
              setInterval(() => {
                
              $.ajax({
              type: "POST",
              url: "vue.php",
              data: '',
              success: function(data) {
                
                var response = JSON.parse(data)
                var total_prix_ticket = response.TOTAL_PRIX_TICKET.map(item=>item.montant_total_ticket)
                var option_gare = response.gare.map(item =>'<option value="'+item.id_gare+' ">'+item.nom_Gare+'</option>'  ).join(' ')
                $('#option_gare').html(option_gare)
                var nombre_gare=Object.keys(response.gare).length // compte le nombre de gares en comptant les id id de la gare
                $('#nombre_gare').html(nombre_gare)
                var liste_user = response.user.map(item=>'<tr><td>'+item.nom_Utilisateurs+'</td><td>'+item.prenom_Utilisateurs+'</td><td>'+item.tel_Utilisateurs+'</td><td>'+item.nom_Gare+'</td><td>'+item.nbre_ticket+'</td><td>'+item.total_ticket+' cfa</td><td>'+item.situation_geographique_Gare+'</td><td><div class="progress bg-light-danger" style="height: 6px ; "><div class="progress-bar bg-gradient-quepal" role="progressbar" style="width: '+(100*parseFloat(item.total_ticket)/parseFloat(total_prix_ticket)).toFixed(0)+'"></div></div></td><td style="font-size:11px">'+(100*parseFloat(item.total_ticket)/parseFloat(total_prix_ticket)).toFixed(2)+'%</td><tr>')
                $('.user_info').html(liste_user)
                var nbre_ticket_gare = response.nbre_ticket_gare.map(item=> '<li class="list-group-item d-flex bg-transparent justify-content-between align-items-center">'+item.nom_Gare+'<span class="badge bg-danger rounded-pill">'+item.nbre_ticket+'</span></li>').join(' ')
                $('#list_gare').html(nbre_ticket_gare)
              }
              }); 
              }, 3000);
            
              
             
              //fin script pour lister les gare

            });
            </script>
